{"version":3,"sources":["Scaffold.ts","DaVinci.ts","DaVinciSpec.tsx","Download.ts","Parts.tsx","App.tsx","reportWebVitals.js","index.js"],"names":["Chirality","adjacent","v0","v1","push","Scaffold","frequency","radius","chirality","vertices","VERTEX","forEach","location","vertexAt","EDGE","edge","midVertices","map","midEdge","vertexBetween","FACE_EDGES","faceEdge","side0","side1","side2","this","buildFaces","buildEdgeVertices","vertex","outward","Vector3","copy","normalize","first","pop","Error","sorted","vectorTo","subVectors","top","length","next","find","v","toAdjacent","toTop","dot","dotProduct","crossVectors","Left","Right","filter","adj","index","sortVertex","edgeVertices","edgeVertexIndex","previousVertex","verticesOfEdge","walk","loc0","loc1","spot","lerpVectors","faceVertexArrays","FACE_VERTICES","faceVertexIndex","faceIndex","faceVertex","which","origin","walkA","vectorA","sub","walkB","v2","vectorB","add","row","rowMember","vert","sideVertices","antiWalk","walkSide","faceEdges","vsVertex","PENTAGON_VERTICES","vertexArray","current","edgeVertexA","front","edgeVertexB","lerp","multiplyScalar","ONE","PHI","barName","vertexA","vertexB","min","Math","max","daVinci","scaffold","angle","twist","joints","freshJoint","point","node","bars","dictionary","adjacentVertex","jointA","jointB","jointC","bar","jointD","hubs","adjacentBars","intersect","planeBar","lineBar","extendBar","normal","plane","Plane","findIndex","extend","start","end","nextLine","Line3","intersectionPoint","intersectLine","distanceTo","axis","applyAxisAngle","bolts","hub","currentBar","nextIndex","nextBar","bolt","degreesToRadians","degree","PI","SpecEditor","spec","setSpec","useState","toString","setFrequency","degrees","setDegrees","setRadius","boltWidth","setBoltWidth","barWidth","setBarWidth","barHeight","setBarHeight","barExtension","setBarExtension","boltExtension","setBoltExtension","isFrequencyValid","value","f","parseInt","isNaN","onSubmit","event","preventDefault","daVinciSpec","parseFloat","handleSubmit","className","target","href","for","id","valid","invalid","onChange","type","csvNumber","n","toFixed","replace","saveCSVZip","output","zip","JSZip","file","rows","joint","x","y","z","join","extractNodeFile","daVinciIntervals","interval","indexString","nodeIndexes","i","extractIntervalFile","generateAsync","mimeType","then","blob","FileSaver","saveAs","Date","toISOString","UP","DOWN","BarBox","renderSpec","unit","midpoint","tangent","basis","Matrix4","makeBasis","setPosition","scale","matrix","matrixAutoUpdate","attach","color","BoltCylinder","position","rotation","Euler","setFromQuaternion","Quaternion","setFromUnitVectors","args","INITIAL_RENDER_SPEC","chiralityFromSpec","App","setRenderSpec","setScaffold","davinciResult","setDavinciResult","version","setVersion","useEffect","radians","abs","freshScaffold","onClick","daVinciOutput","intensity","onDoubleClick","face","camera","transparent","opacity","PerspectiveCamera","makeDefault","OrbitControls","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.192a2484.chunk.js","sourcesContent":["/*\r\n * Copyright (c) 2021. BURO Civiel, Rotterdam, Netherlands\r\n * Licensed under GNU GENERAL PUBLIC LICENSE Version 3.\r\n */\r\n\r\nimport {Vector3} from \"three\"\r\n\r\nexport interface Vertex {\r\n    index: number,\r\n    location: Vector3\r\n    adjacent: Vertex[]\r\n}\r\n\r\nfunction adjacent(v0: Vertex, v1: Vertex): void {\r\n    v0.adjacent.push(v1)\r\n    v1.adjacent.push(v0)\r\n}\r\n\r\nexport enum Chirality {\r\n    Left, Right,\r\n}\r\n\r\nexport class Scaffold {\r\n    public readonly vertices: Vertex[] = []\r\n\r\n    constructor(public readonly frequency: number, public readonly radius: number, public readonly chirality: Chirality) {\r\n        VERTEX.forEach(location => this.vertexAt(location))\r\n        if (frequency === 1) {\r\n            EDGE.forEach(edge => {\r\n                const v0 = this.vertices[edge[0]]\r\n                const v1 = this.vertices[edge[1]]\r\n                adjacent(v0, v1)\r\n            })\r\n        } else if (frequency === 2) {\r\n            const midVertices = EDGE.map(edge => {\r\n                const v0 = this.vertices[edge[0]]\r\n                const v1 = this.vertices[edge[1]]\r\n                const midEdge = this.vertexBetween(v0, v1)\r\n                adjacent(v0, midEdge)\r\n                adjacent(midEdge, v1)\r\n                return midEdge\r\n            })\r\n            FACE_EDGES.forEach(faceEdge => {\r\n                const side0 = midVertices[faceEdge[0]]\r\n                const side1 = midVertices[faceEdge[1]]\r\n                const side2 = midVertices[faceEdge[2]]\r\n                adjacent(side0, side1)\r\n                adjacent(side1, side2)\r\n                adjacent(side2, side0)\r\n            })\r\n        } else {\r\n            this.buildFaces(this.buildEdgeVertices())\r\n        }\r\n        this.vertices.forEach(vertex => sortVertex(vertex, chirality))\r\n    }\r\n\r\n    private buildEdgeVertices(): Vertex[][] {\r\n        const edgeVertices: Vertex[][] = []\r\n        EDGE.forEach(edgeVertexIndex => {\r\n            const verticesOfEdge: Vertex[] = []\r\n            edgeVertices.push(verticesOfEdge)\r\n            let vertex: Vertex | undefined\r\n            let previousVertex: Vertex | undefined\r\n            for (let walk = 0; walk < this.frequency - 1; walk++) {\r\n                previousVertex = vertex\r\n                const v0 = this.vertices[edgeVertexIndex[0]]\r\n                const v1 = this.vertices[edgeVertexIndex[1]]\r\n                const loc0 = v0.location\r\n                const loc1 = v1.location\r\n                const spot = new Vector3().lerpVectors(loc0, loc1, (walk + 1) / this.frequency)\r\n                vertex = this.vertexAt(spot)\r\n                verticesOfEdge.push(vertex)\r\n                if (previousVertex) {\r\n                    adjacent(vertex, previousVertex)\r\n                    if (walk === this.frequency - 2) {\r\n                        adjacent(vertex, v1)\r\n                    }\r\n                } else {\r\n                    adjacent(vertex, v0)\r\n                }\r\n            }\r\n        })\r\n        return edgeVertices\r\n    }\r\n\r\n    private buildFaces(edgeVertices: Vertex[][]): void {\r\n        const faceVertexArrays: Vertex[][] = []\r\n        FACE_VERTICES.forEach((faceVertexIndex, faceIndex) => {\r\n            const faceVertex = (which: number) => this.vertices[faceVertexIndex[which]]\r\n            const v0 = faceVertex(0)\r\n            const origin = v0.location\r\n            // interpolate along the edges of the face creating arrays of vertices on the way\r\n            for (let walkA = 1; walkA < this.frequency - 1; walkA++) {\r\n                const v1 = faceVertex(1)\r\n                const vectorA = new Vector3().lerpVectors(origin, v1.location, walkA / this.frequency)\r\n                vectorA.sub(origin)\r\n                faceVertexArrays[walkA - 1] = []\r\n                for (let walkB = 1; walkB < this.frequency - walkA; walkB++) {\r\n                    const v2 = faceVertex(2)\r\n                    const vectorB = new Vector3().lerpVectors(origin, v2.location, walkB / this.frequency)\r\n                    vectorB.sub(origin)\r\n                    const spot = new Vector3().copy(origin)\r\n                    spot.add(vectorA)\r\n                    spot.add(vectorB)\r\n                    faceVertexArrays[walkA - 1].push(this.vertexAt(spot))\r\n                }\r\n            }\r\n            // define the adjacency among face vertices\r\n            for (let row = 0; row < faceVertexArrays.length; row++) {\r\n                for (let rowMember = 0; rowMember < faceVertexArrays[row].length; rowMember++) {\r\n                    if (rowMember < faceVertexArrays[row].length - 1) {\r\n                        adjacent(faceVertexArrays[row][rowMember], faceVertexArrays[row][rowMember + 1])\r\n                    }\r\n                    if (row > 0) {\r\n                        const vert = faceVertexArrays[row][rowMember]\r\n                        adjacent(vert, faceVertexArrays[row - 1][rowMember])\r\n                        adjacent(vert, faceVertexArrays[row - 1][rowMember + 1])\r\n                    }\r\n                }\r\n            }\r\n            // compile side vertices (of a triangle!) reversing traversal when necessary\r\n            const sideVertices: Vertex[] [] = [[], [], []]\r\n            for (let walk = 0; walk < this.frequency - 2; walk++) {\r\n                const antiWalk = faceVertexArrays.length - walk - 1\r\n                sideVertices[0].push(faceVertexArrays[walk][0])\r\n                sideVertices[1].push(faceVertexArrays[antiWalk][faceVertexArrays[antiWalk].length - 1])\r\n                sideVertices[2].push(faceVertexArrays[0][walk])\r\n            }\r\n            // define adjacency between face vertices and edge vertices\r\n            for (let walkSide = 0; walkSide < sideVertices.length; walkSide++) {\r\n                const faceEdges = FACE_EDGES[faceIndex]\r\n                const edge = edgeVertices[faceEdges[walkSide]]\r\n                for (let walk = 0; walk < faceVertexArrays.length; walk++) {\r\n                    const vsVertex = sideVertices[walkSide][walk]\r\n                    adjacent(vsVertex, edge[walk])\r\n                    adjacent(vsVertex, edge[walk + 1])\r\n                }\r\n            }\r\n        })\r\n        PENTAGON_VERTICES.forEach(vertexArray => {\r\n            // define the adjacency for this pentagon\r\n            for (let current = 0; current < vertexArray.length; current++) {\r\n                const next = (current + 1) % vertexArray.length\r\n                const edgeVertexA = vertexArray[current].front ? 0 : this.frequency - 2\r\n                const edgeVertexB = vertexArray[next].front ? 0 : this.frequency - 2\r\n                const vertexA = edgeVertices[vertexArray[current].edge][edgeVertexA]\r\n                const vertexB = edgeVertices[vertexArray[next].edge][edgeVertexB]\r\n                adjacent(vertexA, vertexB)\r\n            }\r\n        })\r\n    }\r\n\r\n    private vertexBetween(v0: Vertex, v1: Vertex): Vertex {\r\n        const location = new Vector3().copy(v0.location).lerp(v1.location, 0.5)\r\n        return this.vertexAt(location)\r\n    }\r\n\r\n    private vertexAt(location: Vector3): Vertex {\r\n        const length = location.length()\r\n        location.multiplyScalar(this.radius / length)\r\n        const index = this.vertices.length\r\n        const vertex = {index, location, adjacent: []}\r\n        this.vertices.push(vertex)\r\n        return vertex\r\n    }\r\n}\r\n\r\nconst NUL = 0.0\r\nconst ONE = 0.5257311121191336\r\nconst PHI = 0.8506508083520400\r\n\r\nconst VERTEX: Vector3[] = [\r\n    new Vector3(+ONE, NUL, +PHI), new Vector3(+ONE, NUL, -PHI),\r\n    new Vector3(+PHI, +ONE, NUL), new Vector3(-PHI, +ONE, NUL),\r\n    new Vector3(NUL, +PHI, +ONE), new Vector3(NUL, -PHI, +ONE),\r\n    new Vector3(-ONE, NUL, -PHI), new Vector3(-ONE, NUL, +PHI),\r\n    new Vector3(-PHI, -ONE, NUL), new Vector3(+PHI, -ONE, NUL),\r\n    new Vector3(NUL, -PHI, -ONE), new Vector3(NUL, +PHI, -ONE),\r\n]\r\n\r\nconst EDGE = [\r\n    [0, 2], [0, 4], [0, 5], [0, 7], [0, 9],\r\n    [1, 10], [1, 11], [1, 2], [1, 6], [1, 9],\r\n    [2, 11], [2, 4], [2, 9], [3, 11], [3, 4],\r\n    [3, 6], [3, 7], [3, 8], [4, 11], [4, 7],\r\n    [5, 10], [5, 7], [5, 8], [5, 9], [6, 10],\r\n    [6, 11], [6, 8], [7, 8], [8, 10], [9, 10],\r\n]\r\n\r\nconst FACE_VERTICES = [\r\n    [0, 2, 4], [0, 2, 9], [0, 4, 7], [0, 5, 7], [0, 5, 9],\r\n    [1, 2, 11], [1, 2, 9], [1, 6, 10], [1, 6, 11], [1, 9, 10],\r\n    [2, 4, 11], [3, 4, 11], [3, 4, 7], [3, 6, 11], [3, 6, 8],\r\n    [3, 7, 8], [5, 7, 8], [5, 8, 10], [5, 9, 10], [6, 8, 10],\r\n]\r\n\r\nconst FACE_EDGES = [\r\n    [0, 11, 1], [0, 12, 4], [1, 19, 3], [2, 21, 3], [2, 23, 4],\r\n    [7, 10, 6], [7, 12, 9], [8, 24, 5], [8, 25, 6], [9, 29, 5],\r\n    [11, 18, 10], [14, 18, 13], [14, 19, 16], [15, 25, 13], [15, 26, 17],\r\n    [16, 27, 17], [21, 27, 22], [22, 28, 20], [23, 29, 20], [26, 28, 24],\r\n]\r\n\r\ninterface PentagonVertex {\r\n    edge: number\r\n    front: boolean\r\n}\r\n\r\nconst PENTAGON_VERTICES: PentagonVertex[][] = [\r\n    [{edge: 0, front: true}, {edge: 1, front: true},\r\n        {edge: 3, front: true}, {edge: 2, front: true}, {edge: 4, front: true}],\r\n    [{edge: 7, front: true}, {edge: 6, front: true},\r\n        {edge: 8, front: true}, {edge: 5, front: true}, {edge: 9, front: true}],\r\n    [{edge: 10, front: true}, {edge: 11, front: true},\r\n        {edge: 0, front: false}, {edge: 12, front: true}, {edge: 7, front: false}],\r\n    [{edge: 14, front: true}, {edge: 13, front: true},\r\n        {edge: 15, front: true}, {edge: 17, front: true}, {edge: 16, front: true}],\r\n    [{edge: 18, front: true}, {edge: 11, front: false},\r\n        {edge: 1, front: false}, {edge: 19, front: true}, {edge: 14, front: false}],\r\n    [{edge: 21, front: true}, {edge: 22, front: true},\r\n        {edge: 20, front: true}, {edge: 23, front: true}, {edge: 2, front: false}],\r\n    [{edge: 26, front: true}, {edge: 24, front: true},\r\n        {edge: 8, front: false}, {edge: 25, front: true}, {edge: 15, front: false}],\r\n    [{edge: 27, front: true}, {edge: 16, front: false},\r\n        {edge: 19, front: false}, {edge: 3, front: false}, {edge: 21, front: false}],\r\n    [{edge: 28, front: true}, {edge: 22, front: false},\r\n        {edge: 27, front: false}, {edge: 17, front: false}, {edge: 26, front: false}],\r\n    [{edge: 4, front: false}, {edge: 23, front: false},\r\n        {edge: 29, front: true}, {edge: 9, front: false}, {edge: 12, front: false}],\r\n    [{edge: 28, front: false}, {edge: 20, front: false},\r\n        {edge: 29, front: false}, {edge: 5, front: false}, {edge: 24, front: false}],\r\n    [{edge: 6, front: false}, {edge: 10, front: false},\r\n        {edge: 18, front: false}, {edge: 13, front: false}, {edge: 25, front: false}],\r\n]\r\n\r\n// sort the adjacent vertices of a vertex in a clockwise way\r\nfunction sortVertex(vertex: Vertex, chirality: Chirality): void {\r\n    const outward = new Vector3().copy(vertex.location).normalize()\r\n    const first = vertex.adjacent.pop()\r\n    if (!first) {\r\n        throw new Error(\"No first to pop!\")\r\n    }\r\n    const sorted: Vertex[] = [first]\r\n    const vectorTo = ({location}: Vertex) => new Vector3().subVectors(location, vertex.location).normalize()\r\n    while (vertex.adjacent.length > 0) {\r\n        const top: Vertex = sorted[sorted.length - 1]\r\n        const next = vertex.adjacent.find(v => {\r\n            const toAdjacent = vectorTo(v)\r\n            const toTop = vectorTo(top)\r\n            if (toAdjacent.dot(toTop) < 0.25) {\r\n                return false\r\n            }\r\n            const dotProduct = new Vector3().crossVectors(toTop, toAdjacent).dot(outward)\r\n            switch (chirality) {\r\n                case Chirality.Left:\r\n                    return dotProduct > 0\r\n                case Chirality.Right:\r\n                    return dotProduct < 0\r\n                default:\r\n                    throw new Error(\"Unknown chirality\")\r\n            }\r\n        })\r\n        if (!next) {\r\n            throw new Error(\"No next found\")\r\n        }\r\n        sorted.push(next)\r\n        vertex.adjacent = vertex.adjacent.filter(adj => adj.index !== next.index)\r\n    }\r\n    vertex.adjacent = sorted\r\n}\r\n","/*\r\n * Copyright (c) 2021. BURO Civiel, Rotterdam, Netherlands\r\n * Licensed under GNU GENERAL PUBLIC LICENSE Version 3.\r\n */\r\n\r\nimport {Line3, Plane, Vector3} from \"three\"\r\n\r\nimport {DaVinciInterval, DaVinciOutput} from \"./Download\"\r\nimport {Chirality, Scaffold, Vertex} from \"./Scaffold\"\r\n\r\nexport interface Joint {\r\n    index: number\r\n    point: Vector3\r\n}\r\n\r\nexport interface Bar {\r\n    index: number\r\n    jointA: Joint\r\n    jointB: Joint\r\n    jointC: Joint\r\n    jointD: Joint\r\n    vertexA: Vertex\r\n    vertexB: Vertex\r\n}\r\n\r\nexport interface Bolt {\r\n    index: number\r\n    jointA: Joint\r\n    jointB: Joint\r\n}\r\n\r\nexport interface DaVinciResult {\r\n    bars: Bar[]\r\n    bolts: Bolt[]\r\n    joints: Joint[]\r\n}\r\n\r\nexport interface Hub {\r\n    adjacentBars: Bar[]\r\n}\r\n\r\nfunction barName(vertexA: Vertex, vertexB: Vertex): string {\r\n    const min = Math.min(vertexA.index, vertexB.index)\r\n    const max = Math.max(vertexA.index, vertexB.index)\r\n    return `${min},${max}`\r\n}\r\n\r\nexport function daVinci(scaffold: Scaffold, angle: number): DaVinciResult {\r\n    const twist = angle * (scaffold.chirality === Chirality.Left ? 1 : -1)\r\n    const joints: Joint[] = []\r\n\r\n    function freshJoint(point: Vector3): Joint {\r\n        const index = joints.length\r\n        const node: Joint = {index, point}\r\n        joints.push(node)\r\n        return node\r\n    }\r\n\r\n    const bars: Bar[] = []\r\n    const dictionary: Record<string, Bar> = {}\r\n    scaffold.vertices.forEach(vertex => {\r\n        vertex.adjacent.forEach(adjacentVertex => {\r\n            if (adjacentVertex.index > vertex.index) {\r\n                return\r\n            }\r\n            const index = bars.length\r\n            const jointA = freshJoint(new Vector3().copy(vertex.location))\r\n            const jointB = freshJoint(new Vector3())\r\n            const jointC = freshJoint(new Vector3())\r\n            const jointD = freshJoint(new Vector3().copy(adjacentVertex.location))\r\n            const vertexA = vertex\r\n            const vertexB = adjacentVertex\r\n            const bar: Bar = {index, jointA, jointD, jointB, jointC, vertexA, vertexB}\r\n            bars.push(bar)\r\n            dictionary[barName(bar.vertexA, bar.vertexB)] = bar\r\n        })\r\n    })\r\n    const hubs = scaffold.vertices.map(vertex => {\r\n        const adjacentBars = vertex.adjacent.map(adjacentVertex => dictionary[barName(vertex, adjacentVertex)])\r\n        const hub: Hub = {adjacentBars}\r\n        return hub\r\n    })\r\n    bars.forEach(({jointA, jointD}) => {\r\n        const axis = new Vector3().lerpVectors(jointA.point, jointD.point, 0.5).normalize()\r\n        jointA.point.applyAxisAngle(axis, twist)\r\n        jointD.point.applyAxisAngle(axis, twist)\r\n    })\r\n\r\n    function intersect(planeBar: Bar, lineBar: Bar, extendBar: boolean): Joint {\r\n        const normal = new Vector3().crossVectors(planeBar.jointA.point, planeBar.jointD.point).normalize()\r\n        const plane = new Plane(normal)\r\n        const hubA = hubs[planeBar.vertexA.index]\r\n        const adjacentIndex = hubA.adjacentBars.findIndex(adj => adj.index === planeBar.index)\r\n        if (adjacentIndex < 0) {\r\n            throw new Error(\"adjacent not found\")\r\n        }\r\n        const extend = (start: Vector3, end: Vector3) =>\r\n            new Vector3().copy(end).add(new Vector3().subVectors(end, start))\r\n        const nextLine = new Line3(\r\n            extend(lineBar.jointA.point, lineBar.jointD.point),\r\n            extend(lineBar.jointD.point, lineBar.jointA.point),\r\n        )\r\n        const intersectionPoint = new Vector3()\r\n        plane.intersectLine(nextLine, intersectionPoint)\r\n        const distA = intersectionPoint.distanceTo(lineBar.jointA.point)\r\n        const distB = intersectionPoint.distanceTo(lineBar.jointD.point)\r\n        const forward = distA < distB\r\n        if (forward) {\r\n            if (extendBar) {\r\n                lineBar.jointA.point.copy(intersectionPoint)\r\n                return lineBar.jointA\r\n            } else {\r\n                lineBar.jointB.point.copy(intersectionPoint)\r\n                return lineBar.jointB\r\n            }\r\n        } else {\r\n            if (extendBar) {\r\n                lineBar.jointD.point.copy(intersectionPoint)\r\n                return lineBar.jointD\r\n            } else {\r\n                lineBar.jointC.point.copy(intersectionPoint)\r\n                return lineBar.jointC\r\n            }\r\n        }\r\n    }\r\n\r\n    const bolts: Bolt [] = []\r\n    hubs.forEach(hub => {\r\n        hub.adjacentBars.forEach((currentBar, index) => {\r\n            const nextIndex = (index + 1) % hub.adjacentBars.length\r\n            const nextBar = hub.adjacentBars[nextIndex]\r\n            const nodeA = intersect(currentBar, nextBar, true)\r\n            const nodeB = intersect(nextBar, currentBar, false)\r\n            const bolt: Bolt = {jointA: nodeA, jointB: nodeB, index: bars.length + bolts.length}\r\n            bolts.push(bolt)\r\n        })\r\n    })\r\n    return {bars, bolts, joints}\r\n}\r\n\r\nexport function radiansToDegrees(radian: number): number {\r\n    return 180 / (radian * Math.PI)\r\n}\r\n\r\nexport function degreesToRadians(degree: number): number {\r\n    return Math.PI * degree / 180\r\n}\r\n\r\nexport function daVinciOutput(bars: Bar[], bolts: Bolt[], joints: Joint[]): DaVinciOutput {\r\n    const daVinciIntervals: DaVinciInterval [] = []\r\n    bars.forEach((bar) => {\r\n        daVinciIntervals.push({\r\n            nodeIndexes: [bar.jointA.index, bar.jointB.index, bar.jointC.index, bar.jointD.index],\r\n            type: \"type 1\",\r\n        })\r\n    })\r\n    bolts.forEach((bolt) => {\r\n        daVinciIntervals.push({\r\n            nodeIndexes: [bolt.jointA.index, bolt.jointB.index],\r\n            type: \"type 2\",\r\n        })\r\n    })\r\n    return {joints, daVinciIntervals}\r\n}\r\n","\r\n/*\r\n * Copyright (c) 2021. BURO Civiel, Rotterdam, Netherlands\r\n * Licensed under GNU GENERAL PUBLIC LICENSE Version 3.\r\n */\r\n\r\nimport * as React from \"react\"\r\nimport {useState} from \"react\"\r\nimport {Button, Form, FormGroup, Input, Label} from \"reactstrap\"\r\n\r\nexport interface DaVinciSpec {\r\n    frequency: number\r\n    degrees: number\r\n    radius: number\r\n    boltWidth: number\r\n    barWidth: number\r\n    barHeight: number\r\n    barExtension: number\r\n    boltExtension: number\r\n}\r\n\r\nexport function SpecEditor({spec, setSpec}: { spec: DaVinciSpec, setSpec: (spec: DaVinciSpec) => void }): JSX.Element {\r\n    const [frequency, setFrequency] = useState(spec.frequency.toString())\r\n    const [degrees, setDegrees] = useState(spec.degrees.toString())\r\n    const [radius, setRadius] = useState(spec.radius.toString())\r\n    const [boltWidth, setBoltWidth] = useState(spec.boltWidth.toString())\r\n    const [barWidth, setBarWidth] = useState(spec.barWidth.toString())\r\n    const [barHeight, setBarHeight] = useState(spec.barHeight.toString())\r\n    const [barExtension, setBarExtension] = useState(spec.barExtension.toString())\r\n    const [boltExtension, setBoltExtension] = useState(spec.boltExtension.toString())\r\n\r\n    function handleSubmit(): void {\r\n        const daVinciSpec: DaVinciSpec = {\r\n            frequency: parseInt(frequency, 10),\r\n            degrees: parseFloat(degrees),\r\n            radius: parseFloat(radius),\r\n            boltWidth: parseFloat(boltWidth),\r\n            barWidth: parseFloat(barWidth),\r\n            barHeight: parseFloat(barHeight),\r\n            barExtension: parseFloat(barExtension),\r\n            boltExtension: parseFloat(boltExtension),\r\n        }\r\n        if (!(!isFrequencyValid(frequency) || isNaN(daVinciSpec.degrees) || isNaN(daVinciSpec.radius) ||\r\n            isNaN(daVinciSpec.boltWidth) || isNaN(daVinciSpec.barWidth) || isNaN(daVinciSpec.barHeight)\r\n            || isNaN(daVinciSpec.barExtension) || isNaN(daVinciSpec.boltExtension))) {\r\n            setSpec(daVinciSpec)\r\n        }\r\n    }\r\n\r\n    function isFrequencyValid(value: string): boolean {\r\n        const f = parseInt(value, 10)\r\n        if (isNaN(f)) {\r\n            return false\r\n        }\r\n        return f <= 10 && f > 0\r\n    }\r\n\r\n    return (\r\n        <Form onSubmit={event => {\r\n            event.preventDefault()\r\n            handleSubmit()\r\n        }} className=\"top-left bg-light\">\r\n            <FormGroup>\r\n                <h3><a target=\"_BLANK\" href=\"https://github.com/CivilSource/DavinciDome\">Da Vinci App</a></h3>\r\n            </FormGroup>\r\n            <FormGroup>\r\n                <Label for=\"frequency\">Frequency (1-10)</Label>\r\n                <Input id=\"frequency\"\r\n                       value={frequency}\r\n                       valid={isFrequencyValid(frequency)}\r\n                       invalid={!isFrequencyValid(frequency)}\r\n                       onChange={({target}) => setFrequency(target.value)}/>\r\n            </FormGroup>\r\n            <FormGroup>\r\n                <Label for=\"degrees\">Degrees</Label>\r\n                <Input id=\"degrees\"\r\n                       value={degrees}\r\n                       valid={!isNaN(parseFloat(degrees))}\r\n                       invalid={isNaN(parseFloat(degrees))}\r\n                       onChange={({target}) => setDegrees(target.value)}/>\r\n            </FormGroup>\r\n            <FormGroup>\r\n                <Label for=\"radius\">Radius</Label>\r\n                <Input id=\"radius\"\r\n                       value={radius}\r\n                       valid={!isNaN(parseFloat(radius))}\r\n                       invalid={isNaN(parseFloat(radius))}\r\n                       onChange={({target}) => setRadius(target.value)}/>\r\n            </FormGroup>\r\n            <FormGroup>\r\n                <Label for=\"boltWidth\">Bolt Width</Label>\r\n                <Input id=\"boltWidth\"\r\n                       value={boltWidth}\r\n                       valid={!isNaN(parseFloat(boltWidth))}\r\n                       invalid={isNaN(parseFloat(boltWidth))}\r\n                       onChange={({target}) => setBoltWidth(target.value)}/>\r\n            </FormGroup>\r\n            <FormGroup>\r\n                <Label for=\"barWidth\">Bar Width</Label>\r\n                <Input id=\"barWidth\"\r\n                       value={barWidth}\r\n                       valid={!isNaN(parseFloat(barWidth))}\r\n                       invalid={isNaN(parseFloat(barWidth))}\r\n                       onChange={({target}) => setBarWidth(target.value)}/>\r\n            </FormGroup>\r\n            <FormGroup>\r\n                <Label for=\"barHeight\">Bar Height</Label>\r\n                <Input id=\"barHeight\"\r\n                       value={barHeight}\r\n                       valid={!isNaN(parseFloat(barHeight))}\r\n                       invalid={isNaN(parseFloat(barHeight))}\r\n                       onChange={({target}) => setBarHeight(target.value)}/>\r\n            </FormGroup>\r\n            <FormGroup>\r\n                <Label for=\"boltExtension\">Bolt Extension</Label>\r\n                <Input id=\"boltExtension\"\r\n                       value={boltExtension}\r\n                       valid={!isNaN(parseFloat(boltExtension))}\r\n                       invalid={isNaN(parseFloat(boltExtension))}\r\n                       onChange={({target}) => setBoltExtension(target.value)}/>\r\n            </FormGroup>\r\n            <FormGroup>\r\n                <Label for=\"barExtension\">Bar Extension</Label>\r\n                <Input id=\"barExtension\"\r\n                       value={barExtension}\r\n                       valid={!isNaN(parseFloat(barExtension))}\r\n                       invalid={isNaN(parseFloat(barExtension))}\r\n                       onChange={({target}) => setBarExtension(target.value)}/>\r\n            </FormGroup>\r\n            <hr/>\r\n            <FormGroup>\r\n                <Button className=\"w-100\" type=\"submit\">Generate</Button>\r\n            </FormGroup>\r\n        </Form>\r\n    )\r\n}\r\n","/*\r\n * Copyright (c) 2021. BURO Civiel, Rotterdam, Netherlands\r\n * Licensed under GNU GENERAL PUBLIC LICENSE Version 3.\r\n */\r\n\r\nimport FileSaver from \"file-saver\"\r\nimport JSZip from \"jszip\"\r\n\r\nimport {Joint} from \"./DaVinci\"\r\n\r\nexport interface DaVinciInterval {\r\n    nodeIndexes: number[]\r\n    type: string\r\n}\r\n\r\nexport interface DaVinciOutput {\r\n    joints: Joint[]\r\n    daVinciIntervals: DaVinciInterval[]\r\n}\r\n\r\nfunction extractNodeFile(output: DaVinciOutput): string {\r\n    const rows: string[][] = []\r\n    rows.push([\"index\", \"x\", \"y\", \"z\"])\r\n    output.joints.forEach((joint, index) => rows.push([\r\n        (index + 1).toFixed(0),\r\n        csvNumber(joint.point.x), csvNumber(joint.point.y), csvNumber(joint.point.z),\r\n    ]))\r\n    return rows.map(row => row.join(\";\")).join(\"\\n\")\r\n}\r\n\r\nfunction extractIntervalFile(output: DaVinciOutput): string {\r\n    const rows: string[][] = []\r\n    rows.push([\"joints\", \"type\"])\r\n    output.daVinciIntervals.forEach((interval, index) => {\r\n        const indexString = interval.nodeIndexes.map(i => i + 1).join(\",\")\r\n        rows.push([`\"=\"\"${indexString}\"\"\"`, interval.type])\r\n    })\r\n    return rows.map(row => row.join(\";\")).join(\"\\n\")\r\n}\r\n\r\nfunction csvNumber(n: number): string {\r\n    return n.toFixed(5).replace(/[.]/, \",\")\r\n}\r\n\r\nfunction dateString(): string {\r\n    return new Date().toISOString()\r\n        .replace(/[.].*/, \"\").replace(/[:T_]/g, \"-\")\r\n}\r\n\r\nexport function saveCSVZip(output: DaVinciOutput): void {\r\n    const zip = new JSZip()\r\n    zip.file(\"joints.csv\", extractNodeFile(output))\r\n    zip.file(\"intervals.csv\", extractIntervalFile(output))\r\n    zip.generateAsync({type: \"blob\", mimeType: \"application/zip\"}).then(blob => {\r\n        FileSaver.saveAs(blob, `davinci-${dateString()}.zip`)\r\n    })\r\n}\r\n","/*\r\n * Copyright (c) 2021. BURO Civiel, Rotterdam, Netherlands\r\n * Licensed under GNU GENERAL PUBLIC LICENSE Version 3.\r\n */\r\n\r\nimport * as React from \"react\"\r\nimport {Euler, Matrix4, Quaternion, Vector3} from \"three\"\r\n\r\nimport {Bar, Bolt} from \"./DaVinci\"\r\nimport {DaVinciSpec} from \"./DaVinciSpec\"\r\n\r\n\r\nexport function Ball({position, radius}: {\r\n    position: Vector3,\r\n    radius: number,\r\n}): JSX.Element {\r\n    return (\r\n        <mesh position={position}>\r\n            <sphereGeometry args={[radius, 32, 16]}/>\r\n            <meshPhongMaterial color=\"green\"/>\r\n        </mesh>\r\n    )\r\n}\r\n\r\nconst UP = new Vector3(0, 1, 0)\r\nconst DOWN = new Vector3(0, -1, 0)\r\n\r\nexport function BarBox({bar, renderSpec}: { bar: Bar, renderSpec: DaVinciSpec }): JSX.Element {\r\n    const length = bar.jointA.point.distanceTo(bar.jointD.point)\r\n    const unit = new Vector3().subVectors(bar.jointD.point, bar.jointA.point).normalize()\r\n    const midpoint = new Vector3().lerpVectors(bar.jointA.point, bar.jointD.point, 0.5)\r\n    const tangent = new Vector3().crossVectors(midpoint, unit).normalize()\r\n    const basis = new Matrix4()\r\n        .makeBasis(new Vector3().copy(midpoint).normalize(), unit, tangent)\r\n        .setPosition(midpoint)\r\n        .scale(new Vector3(renderSpec.barHeight, length + renderSpec.barExtension, renderSpec.barWidth))\r\n    return (\r\n        <mesh matrix={basis} matrixAutoUpdate={false}>\r\n            <boxBufferGeometry attach=\"geometry\"/>\r\n            <meshLambertMaterial attach=\"material\" color=\"white\"/>\r\n        </mesh>\r\n    )\r\n}\r\n\r\nexport function BoltCylinder({bolt, renderSpec}: { bolt: Bolt, renderSpec: DaVinciSpec }): JSX.Element {\r\n    const length = bolt.jointA.point.distanceTo(bolt.jointB.point)\r\n    const unit = new Vector3().subVectors(bolt.jointB.point, bolt.jointA.point).normalize()\r\n    const position = new Vector3().lerpVectors(bolt.jointA.point, bolt.jointB.point, 0.5)\r\n    const scale = new Vector3(renderSpec.boltWidth, length + renderSpec.boltExtension, renderSpec.boltWidth)\r\n    const dot = UP.dot(unit)\r\n    const rotation = new Euler().setFromQuaternion(new Quaternion().setFromUnitVectors(dot > 0 ? UP : DOWN, unit))\r\n    return (\r\n        <mesh scale={scale} rotation={rotation} position={position}>\r\n            <cylinderBufferGeometry attach=\"geometry\" args={[1, 1, 1]}/>\r\n            <meshLambertMaterial attach=\"material\" color=\"orange\"/>\r\n        </mesh>\r\n    )\r\n}\r\n","/*\r\n * Copyright (c) 2021. BURO Civiel, Rotterdam, Netherlands\r\n * Licensed under GNU GENERAL PUBLIC LICENSE Version 3.\r\n */\r\n\r\nimport {OrbitControls, PerspectiveCamera} from \"@react-three/drei\"\r\nimport {Canvas} from \"@react-three/fiber\"\r\nimport \"bootstrap/dist/css/bootstrap.min.css\"\r\nimport * as React from \"react\"\r\nimport {useEffect, useState} from \"react\"\r\nimport {Button} from \"reactstrap\"\r\n\r\nimport \"./App.css\"\r\nimport {daVinci, daVinciOutput, degreesToRadians} from \"./DaVinci\"\r\nimport {DaVinciSpec, SpecEditor} from \"./DaVinciSpec\"\r\nimport {saveCSVZip} from \"./Download\"\r\nimport {BarBox, BoltCylinder} from \"./Parts\"\r\nimport {Chirality, Scaffold} from \"./Scaffold\"\r\n\r\nconst INITIAL_RENDER_SPEC: DaVinciSpec = {\r\n    frequency: 2,\r\n    degrees: 30,\r\n    radius: 7,\r\n    boltWidth: 0.05,\r\n    barWidth: 0.3,\r\n    barHeight: 0.02,\r\n    barExtension: 0.3,\r\n    boltExtension: 0.2,\r\n}\r\nconst chiralityFromSpec = ({degrees}: DaVinciSpec) => degrees > 0 ? Chirality.Right : Chirality.Left\r\n\r\nfunction App(): JSX.Element {\r\n    const [renderSpec, setRenderSpec] = useState(INITIAL_RENDER_SPEC)\r\n    const [scaffold, setScaffold] = useState(new Scaffold(renderSpec.frequency, renderSpec.radius, chiralityFromSpec(renderSpec)))\r\n    const [davinciResult, setDavinciResult] = useState(daVinci(scaffold, degreesToRadians(renderSpec.degrees)))\r\n    const [version, setVersion] = useState(0)\r\n    useEffect(() => {\r\n        const {frequency, radius, degrees} = renderSpec\r\n        const radians = Math.abs(degreesToRadians(degrees))\r\n        const freshScaffold = new Scaffold(frequency, radius, chiralityFromSpec(renderSpec))\r\n        setScaffold(freshScaffold)\r\n        setDavinciResult(daVinci(freshScaffold, radians))\r\n        setVersion(v => v + 1)\r\n    }, [renderSpec])\r\n    return (\r\n        <div className=\"App\">\r\n            <div className=\"bottom-left\">\r\n                <Button\r\n                    onClick={() => saveCSVZip(daVinciOutput(davinciResult.bars, davinciResult.bolts, davinciResult.joints))}>\r\n                    Download\r\n                </Button>\r\n\r\n            </div>\r\n            <SpecEditor spec={renderSpec} setSpec={spec => setRenderSpec(spec)}/>\r\n            <Canvas className=\"Canvas\">\r\n                <ambientLight intensity={0.05}/>\r\n                <mesh onDoubleClick={event => {\r\n                    const face = event.face\r\n                    if (!face) {\r\n                        return\r\n                    }\r\n                    const position = face.normal.multiplyScalar(event.camera.position.length())\r\n                    event.camera.position.copy(position)\r\n                }}>\r\n                    <boxGeometry args={[1, 1, 1]}/>\r\n                    <meshStandardMaterial transparent={true} opacity={0.8} color=\"orange\"/>\r\n                </mesh>\r\n                {davinciResult.bars.map((bar, index) => (\r\n                    <BarBox key={`bar-${version}-#${index}`} bar={bar} renderSpec={renderSpec}/>\r\n                ))}\r\n                {davinciResult.bolts.map((bolt, index) => (\r\n                    <BoltCylinder key={`bolt-${version}-#${index}`} bolt={bolt} renderSpec={renderSpec}/>\r\n                ))}\r\n                <PerspectiveCamera makeDefault={true} position={[renderSpec.radius * 3, 0, 0]}>\r\n                    <pointLight position={[0, 10 * renderSpec.radius, 0]} color=\"white\"/>\r\n                </PerspectiveCamera>\r\n                <OrbitControls/>\r\n            </Canvas>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default App\r\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}