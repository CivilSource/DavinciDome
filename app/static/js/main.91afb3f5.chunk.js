(this["webpackJsonpdavinci-dome"]=this["webpackJsonpdavinci-dome"]||[]).push([[0],{26:function(e,t,n){},28:function(e,t,n){},41:function(e,t,n){"use strict";n.r(t);var o=n(1),r=n.n(o),i=n(7),c=n.n(i),s=(n(26),n(50)),a=n(51),d=n(6),l=(n(27),n(28),n(2));function h(e,t){e.adjacent.push(t),t.adjacent.push(e)}let j;!function(e){e[e.Left=0]="Left",e[e.Right=1]="Right"}(j||(j={}));class f{constructor(e,t,n){if(this.frequency=e,this.radius=t,this.chirality=n,this.vertices=[],p.forEach((e=>this.vertexAt(e))),1===e)b.forEach((e=>{h(this.vertices[e[0]],this.vertices[e[1]])}));else if(2===e){const e=b.map((e=>{const t=this.vertices[e[0]],n=this.vertices[e[1]],o=this.vertexBetween(t,n);return h(t,o),h(o,n),o}));v.forEach((t=>{const n=e[t[0]],o=e[t[1]],r=e[t[2]];h(n,o),h(o,r),h(r,n)}))}else this.buildFaces(this.buildEdgeVertices());this.vertices.forEach((e=>function(e,t){const n=(new l.Vector3).copy(e.location).normalize(),o=e.adjacent.pop();if(!o)throw new Error("No first to pop!");const r=[o],i=t=>{let{location:n}=t;return(new l.Vector3).subVectors(n,e.location).normalize()};for(;e.adjacent.length>0;){const o=r[r.length-1],c=e.adjacent.find((e=>{const r=i(e),c=i(o);if(r.dot(c)<.25)return!1;const s=(new l.Vector3).crossVectors(c,r).dot(n);switch(t){case j.Left:return s>0;case j.Right:return s<0;default:throw new Error("Unknown chirality")}}));if(!c)throw new Error("No next found");r.push(c),e.adjacent=e.adjacent.filter((e=>e.index!==c.index))}e.adjacent=r}(e,n)))}buildEdgeVertices(){const e=[];return b.forEach((t=>{const n=[];let o,r;e.push(n);for(let e=0;e<this.frequency-1;e++){r=o;const i=this.vertices[t[0]],c=this.vertices[t[1]],s=i.location,a=c.location,d=(new l.Vector3).lerpVectors(s,a,(e+1)/this.frequency);o=this.vertexAt(d),n.push(o),r?(h(o,r),e===this.frequency-2&&h(o,c)):h(o,i)}})),e}buildFaces(e){const t=[];x.forEach(((n,o)=>{const r=e=>this.vertices[n[e]],i=r(0).location;for(let e=1;e<this.frequency-1;e++){const n=r(1),o=(new l.Vector3).lerpVectors(i,n.location,e/this.frequency);o.sub(i),t[e-1]=[];for(let c=1;c<this.frequency-e;c++){const n=r(2),s=(new l.Vector3).lerpVectors(i,n.location,c/this.frequency);s.sub(i);const a=(new l.Vector3).copy(i);a.add(o),a.add(s),t[e-1].push(this.vertexAt(a))}}for(let e=0;e<t.length;e++)for(let n=0;n<t[e].length;n++)if(n<t[e].length-1&&h(t[e][n],t[e][n+1]),e>0){const o=t[e][n];h(o,t[e-1][n]),h(o,t[e-1][n+1])}const c=[[],[],[]];for(let e=0;e<this.frequency-2;e++){const n=t.length-e-1;c[0].push(t[e][0]),c[1].push(t[n][t[n].length-1]),c[2].push(t[0][e])}for(let s=0;s<c.length;s++){const n=v[o],r=e[n[s]];for(let e=0;e<t.length;e++){const t=c[s][e];h(t,r[e]),h(t,r[e+1])}}})),w.forEach((t=>{for(let n=0;n<t.length;n++){const o=(n+1)%t.length,r=t[n].front?0:this.frequency-2,i=t[o].front?0:this.frequency-2;h(e[t[n].edge][r],e[t[o].edge][i])}}))}vertexBetween(e,t){const n=(new l.Vector3).copy(e.location).lerp(t.location,.5);return this.vertexAt(n)}vertexAt(e){const t=e.length();e.multiplyScalar(this.radius/t);const n={index:this.vertices.length,location:e,adjacent:[]};return this.vertices.push(n),n}}const u=.5257311121191336,g=.85065080835204,p=[new l.Vector3(+u,0,+g),new l.Vector3(+u,0,-g),new l.Vector3(+g,+u,0),new l.Vector3(-g,+u,0),new l.Vector3(0,+g,+u),new l.Vector3(0,-g,+u),new l.Vector3(-u,0,-g),new l.Vector3(-u,0,+g),new l.Vector3(-g,-u,0),new l.Vector3(+g,-u,0),new l.Vector3(0,-g,-u),new l.Vector3(0,+g,-u)],b=[[0,2],[0,4],[0,5],[0,7],[0,9],[1,10],[1,11],[1,2],[1,6],[1,9],[2,11],[2,4],[2,9],[3,11],[3,4],[3,6],[3,7],[3,8],[4,11],[4,7],[5,10],[5,7],[5,8],[5,9],[6,10],[6,11],[6,8],[7,8],[8,10],[9,10]],x=[[0,2,4],[0,2,9],[0,4,7],[0,5,7],[0,5,9],[1,2,11],[1,2,9],[1,6,10],[1,6,11],[1,9,10],[2,4,11],[3,4,11],[3,4,7],[3,6,11],[3,6,8],[3,7,8],[5,7,8],[5,8,10],[5,9,10],[6,8,10]],v=[[0,11,1],[0,12,4],[1,19,3],[2,21,3],[2,23,4],[7,10,6],[7,12,9],[8,24,5],[8,25,6],[9,29,5],[11,18,10],[14,18,13],[14,19,16],[15,25,13],[15,26,17],[16,27,17],[21,27,22],[22,28,20],[23,29,20],[26,28,24]],w=[[{edge:0,front:!0},{edge:1,front:!0},{edge:3,front:!0},{edge:2,front:!0},{edge:4,front:!0}],[{edge:7,front:!0},{edge:6,front:!0},{edge:8,front:!0},{edge:5,front:!0},{edge:9,front:!0}],[{edge:10,front:!0},{edge:11,front:!0},{edge:0,front:!1},{edge:12,front:!0},{edge:7,front:!1}],[{edge:14,front:!0},{edge:13,front:!0},{edge:15,front:!0},{edge:17,front:!0},{edge:16,front:!0}],[{edge:18,front:!0},{edge:11,front:!1},{edge:1,front:!1},{edge:19,front:!0},{edge:14,front:!1}],[{edge:21,front:!0},{edge:22,front:!0},{edge:20,front:!0},{edge:23,front:!0},{edge:2,front:!1}],[{edge:26,front:!0},{edge:24,front:!0},{edge:8,front:!1},{edge:25,front:!0},{edge:15,front:!1}],[{edge:27,front:!0},{edge:16,front:!1},{edge:19,front:!1},{edge:3,front:!1},{edge:21,front:!1}],[{edge:28,front:!0},{edge:22,front:!1},{edge:27,front:!1},{edge:17,front:!1},{edge:26,front:!1}],[{edge:4,front:!1},{edge:23,front:!1},{edge:29,front:!0},{edge:9,front:!1},{edge:12,front:!1}],[{edge:28,front:!1},{edge:20,front:!1},{edge:29,front:!1},{edge:5,front:!1},{edge:24,front:!1}],[{edge:6,front:!1},{edge:10,front:!1},{edge:18,front:!1},{edge:13,front:!1},{edge:25,front:!1}]];function m(e,t){const n=Math.min(e.index,t.index),o=Math.max(e.index,t.index);return"".concat(n,",").concat(o)}function O(e,t){const n=t*(e.chirality===j.Left?1:-1),o=[];function r(e){const t={index:o.length,point:e};return o.push(t),t}const i=[],c={};e.vertices.forEach((e=>{e.adjacent.forEach((t=>{if(t.index>e.index)return;const n=i.length,o=r((new l.Vector3).copy(e.location)),s=r(new l.Vector3),a=r(new l.Vector3),d={index:n,jointA:o,jointD:r((new l.Vector3).copy(t.location)),jointB:s,jointC:a,vertexA:e,vertexB:t};i.push(d),c[m(d.vertexA,d.vertexB)]=d}))}));const s=e.vertices.map((e=>({adjacentBars:e.adjacent.map((t=>c[m(e,t)]))})));function a(e,t,n){const o=(new l.Vector3).crossVectors(e.jointA.point,e.jointD.point).normalize(),r=new l.Plane(o);if(s[e.vertexA.index].adjacentBars.findIndex((t=>t.index===e.index))<0)throw new Error("adjacent not found");const i=(e,t)=>(new l.Vector3).copy(t).add((new l.Vector3).subVectors(t,e)),c=new l.Line3(i(t.jointA.point,t.jointD.point),i(t.jointD.point,t.jointA.point)),a=new l.Vector3;r.intersectLine(c,a);return a.distanceTo(t.jointA.point)<a.distanceTo(t.jointD.point)?n?(t.jointA.point.copy(a),t.jointA):(t.jointB.point.copy(a),t.jointB):n?(t.jointD.point.copy(a),t.jointD):(t.jointC.point.copy(a),t.jointC)}i.forEach((e=>{let{jointA:t,jointD:o}=e;const r=(new l.Vector3).lerpVectors(t.point,o.point,.5).normalize();t.point.applyAxisAngle(r,n),o.point.applyAxisAngle(r,n)}));const d=[];return s.forEach((e=>{e.adjacentBars.forEach(((t,n)=>{const o=(n+1)%e.adjacentBars.length,r=e.adjacentBars[o],c={jointA:a(t,r,!0),jointB:a(r,t,!1),index:i.length+d.length};d.push(c)}))})),{bars:i,bolts:d,joints:o}}function y(e){return Math.PI*e/180}var V=n(5),N=n(4);const E=1e3;function S(e){let{spec:t,setSpec:n,saveCSV:r}=e;const[i,c]=Object(o.useState)(t.frequency.toString()),[s,a]=Object(o.useState)(t.degrees.toString()),[d,l]=Object(o.useState)(t.radius.toString()),[h,j]=Object(o.useState)((t.boltWidth*E).toString()),[f,u]=Object(o.useState)((t.barWidth*E).toString()),[g,p]=Object(o.useState)((t.barHeight*E).toString()),[b,x]=Object(o.useState)((t.barExtension*E).toString()),[v,w]=Object(o.useState)((t.boltExtension*E).toString());function m(e){const t=parseInt(e,10);return!isNaN(t)&&(t<=10&&t>0)}return Object(N.jsxs)(V.b,{onSubmit:e=>{e.preventDefault(),function(){const e={frequency:parseInt(i,10),degrees:parseFloat(s),radius:parseFloat(d),boltWidth:parseFloat(h)/E,barWidth:parseFloat(f)/E,barHeight:parseFloat(g)/E,barExtension:parseFloat(b)/E,boltExtension:parseFloat(v)/E};!m(i)||isNaN(e.degrees)||isNaN(e.radius)||isNaN(e.boltWidth)||isNaN(e.barWidth)||isNaN(e.barHeight)||isNaN(e.barExtension)||isNaN(e.boltExtension)||n(e)}()},className:"spec-editor",children:[Object(N.jsx)("h3",{className:"w-100 text-center",children:Object(N.jsx)("a",{target:"_BLANK",href:"https://github.com/CivilSource/DavinciDome",children:"Da Vinci Dome"})}),Object(N.jsx)("hr",{}),Object(N.jsxs)(V.c,{children:[Object(N.jsx)(V.e,{for:"frequency",children:"Frequency [1..10]"}),Object(N.jsx)(V.d,{id:"frequency",value:i,valid:m(i),invalid:!m(i),onChange:e=>{let{target:t}=e;return c(t.value)}})]}),Object(N.jsxs)(V.c,{children:[Object(N.jsx)(V.e,{for:"degrees",children:"Rotation [deg]"}),Object(N.jsx)(V.d,{id:"degrees",value:s,valid:!isNaN(parseFloat(s)),invalid:isNaN(parseFloat(s)),onChange:e=>{let{target:t}=e;return a(t.value)}})]}),Object(N.jsxs)(V.c,{children:[Object(N.jsx)(V.e,{for:"radius",children:"Radius [m]"}),Object(N.jsx)(V.d,{id:"radius",value:d,valid:!isNaN(parseFloat(d)),invalid:isNaN(parseFloat(d)),onChange:e=>{let{target:t}=e;return l(t.value)}})]}),Object(N.jsxs)(V.c,{children:[Object(N.jsx)(V.e,{for:"boltWidth",children:"Bolt Diam [mm]"}),Object(N.jsx)(V.d,{id:"boltWidth",value:h,valid:!isNaN(parseFloat(h)),invalid:isNaN(parseFloat(h)),onChange:e=>{let{target:t}=e;return j(t.value)}})]}),Object(N.jsxs)(V.c,{children:[Object(N.jsx)(V.e,{for:"barWidth",children:"Bar Width [mm]"}),Object(N.jsx)(V.d,{id:"barWidth",value:f,valid:!isNaN(parseFloat(f)),invalid:isNaN(parseFloat(f)),onChange:e=>{let{target:t}=e;return u(t.value)}})]}),Object(N.jsxs)(V.c,{children:[Object(N.jsx)(V.e,{for:"barHeight",children:"Bar Height [mm]"}),Object(N.jsx)(V.d,{id:"barHeight",value:g,valid:!isNaN(parseFloat(g)),invalid:isNaN(parseFloat(g)),onChange:e=>{let{target:t}=e;return p(t.value)}})]}),Object(N.jsxs)(V.c,{children:[Object(N.jsx)(V.e,{for:"boltExtension",children:"Bolt Extra [mm]"}),Object(N.jsx)(V.d,{id:"boltExtension",value:v,valid:!isNaN(parseFloat(v)),invalid:isNaN(parseFloat(v)),onChange:e=>{let{target:t}=e;return w(t.value)}})]}),Object(N.jsxs)(V.c,{children:[Object(N.jsx)(V.e,{for:"barExtension",children:"Bar Extra [mm]"}),Object(N.jsx)(V.d,{id:"barExtension",value:b,valid:!isNaN(parseFloat(b)),invalid:isNaN(parseFloat(b)),onChange:e=>{let{target:t}=e;return x(t.value)}})]}),Object(N.jsx)("hr",{}),Object(N.jsx)(V.a,{color:"success",className:"w-100 my-1",type:"submit",children:"Regenerate"}),Object(N.jsx)(V.a,{color:"info",className:"w-100",onClick:r,children:"Download"})]})}var A=n(17),F=n.n(A),B=n(18),D=n.n(B);function C(e){return e.toFixed(5).replace(/[.]/,",")}function q(e){const t=new D.a;t.file("joints.csv",function(e){const t=[];return t.push(["index","x","y","z"]),e.joints.forEach(((e,n)=>t.push([(n+1).toFixed(0),C(e.point.x),C(e.point.y),C(e.point.z)]))),t.map((e=>e.join(";"))).join("\n")}(e)),t.file("intervals.csv",function(e){const t=[];return t.push(["joints","type"]),e.daVinciIntervals.forEach(((e,n)=>{const o=e.nodeIndexes.map((e=>e+1)).join(",");t.push(['"=""'.concat(o,'"""'),e.type])})),t.map((e=>e.join(";"))).join("\n")}(e)),t.generateAsync({type:"blob",mimeType:"application/zip"}).then((e=>{F.a.saveAs(e,"davinci-".concat((new Date).toISOString().replace(/[.].*/,"").replace(/[:T_]/g,"-"),".zip"))}))}const W=new l.Vector3(0,1,0),L=new l.Vector3(0,-1,0);function z(e){let{bar:t,renderSpec:n}=e;const o=t.jointA.point.distanceTo(t.jointD.point),r=(new l.Vector3).subVectors(t.jointD.point,t.jointA.point).normalize(),i=(new l.Vector3).lerpVectors(t.jointA.point,t.jointD.point,.5),c=(new l.Vector3).crossVectors(i,r).normalize(),s=(new l.Matrix4).makeBasis((new l.Vector3).copy(i).normalize(),r,c).setPosition(i).scale(new l.Vector3(n.barHeight,o+n.barExtension,n.barWidth));return Object(N.jsxs)("mesh",{matrix:s,matrixAutoUpdate:!1,children:[Object(N.jsx)("boxBufferGeometry",{attach:"geometry"}),Object(N.jsx)("meshLambertMaterial",{attach:"material",color:"white"})]})}function I(e){let{bolt:t,renderSpec:n}=e;const o=t.jointA.point.distanceTo(t.jointB.point),r=(new l.Vector3).subVectors(t.jointB.point,t.jointA.point).normalize(),i=(new l.Vector3).lerpVectors(t.jointA.point,t.jointB.point,.5),c=new l.Vector3(n.boltWidth,o+n.boltExtension,n.boltWidth),s=W.dot(r),a=(new l.Euler).setFromQuaternion((new l.Quaternion).setFromUnitVectors(s>0?W:L,r));return Object(N.jsxs)("mesh",{scale:c,rotation:a,position:i,children:[Object(N.jsx)("cylinderBufferGeometry",{attach:"geometry",args:[1,1,1]}),Object(N.jsx)("meshLambertMaterial",{attach:"material",color:"orange"})]})}const H={frequency:2,degrees:30,radius:7,boltWidth:.05,barWidth:.3,barHeight:.02,barExtension:.3,boltExtension:.2},M=e=>{let{degrees:t}=e;return t>0?j.Right:j.Left};var R=function(){const[e,t]=Object(o.useState)([window.innerWidth,window.innerHeight]),[n,r]=Object(o.useState)(H),[i,c]=Object(o.useState)(O(new f(n.frequency,n.radius,M(n)),y(n.degrees))),[l,h]=Object(o.useState)(0);return Object(o.useEffect)((()=>{const e=()=>t([window.innerWidth,window.innerHeight]);return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),Object(o.useEffect)((()=>{const{frequency:e,radius:t,degrees:o}=n,r=Math.abs(y(o));c(O(new f(e,t,M(n)),r)),console.log("RENDER_SPEC",n.radius),h((e=>e+1))}),[n]),Object(N.jsxs)("div",{className:"App",style:{width:e[0],height:e[1]},children:[Object(N.jsx)(S,{spec:n,setSpec:e=>r(e),saveCSV:()=>q(function(e){let{bars:t,bolts:n,joints:o}=e;const r=[];return t.forEach((e=>{r.push({nodeIndexes:[e.jointA.index,e.jointB.index,e.jointC.index,e.jointD.index],type:"type 1"})})),n.forEach((e=>{r.push({nodeIndexes:[e.jointA.index,e.jointB.index],type:"type 2"})})),{joints:o,daVinciIntervals:r}}(i))}),Object(N.jsxs)(d.a,{className:"canvas",children:[Object(N.jsx)("ambientLight",{intensity:.05}),Object(N.jsxs)("mesh",{onDoubleClick:e=>{const t=e.face;if(!t)return;const n=t.normal.multiplyScalar(e.camera.position.length());e.camera.position.copy(n)},children:[Object(N.jsx)("boxGeometry",{args:[1,1,1]}),Object(N.jsx)("meshStandardMaterial",{transparent:!0,opacity:.8,color:"orange"})]}),i.bars.map(((e,t)=>Object(N.jsx)(z,{bar:e,renderSpec:n},"bar-".concat(l,"-#").concat(t)))),i.bolts.map(((e,t)=>Object(N.jsx)(I,{bolt:e,renderSpec:n},"bolt-".concat(l,"-#").concat(t)))),Object(N.jsx)(s.a,{makeDefault:!0,position:[3*n.radius,0,0],children:Object(N.jsx)("pointLight",{position:[0,10*n.radius,0],color:"white"})}),Object(N.jsx)(a.a,{})]})]})};var T=e=>{e&&e instanceof Function&&n.e(3).then(n.bind(null,52)).then((t=>{let{getCLS:n,getFID:o,getFCP:r,getLCP:i,getTTFB:c}=t;n(e),o(e),r(e),i(e),c(e)}))};c.a.render(Object(N.jsx)(r.a.StrictMode,{children:Object(N.jsx)(R,{})}),document.getElementById("root")),T()}},[[41,1,2]]]);
//# sourceMappingURL=main.91afb3f5.chunk.js.map