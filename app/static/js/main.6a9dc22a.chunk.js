(this["webpackJsonpdavinci-dome"]=this["webpackJsonpdavinci-dome"]||[]).push([[0],{45:function(e,t,n){},47:function(e,t,n){},61:function(e,t,n){"use strict";n.r(t);var r,o=n(1),i=n.n(o),a=n(18),c=n.n(a),s=(n(45),n(13)),d=n(70),u=n(71),f=n(16),l=(n(46),n(47),n(6)),j=n(2),h=n(3);function g(e,t){e.adjacent.push(t),t.adjacent.push(e)}!function(e){e[e.Left=0]="Left",e[e.Right=1]="Right"}(r||(r={}));var v=function(){function e(t,n,o){var i=this;if(Object(j.a)(this,e),this.frequency=t,this.radius=n,this.chirality=o,this.vertices=[],x.forEach((function(e){return i.vertexAt(e)})),1===t)w.forEach((function(e){g(i.vertices[e[0]],i.vertices[e[1]])}));else if(2===t){var a=w.map((function(e){var t=i.vertices[e[0]],n=i.vertices[e[1]],r=i.vertexBetween(t,n);return g(t,r),g(r,n),r}));m.forEach((function(e){var t=a[e[0]],n=a[e[1]],r=a[e[2]];g(t,n),g(n,r),g(r,t)}))}else this.buildFaces(this.buildEdgeVertices());this.vertices.forEach((function(e){return function(e,t){var n=(new l.Vector3).copy(e.location).normalize(),o=e.adjacent.pop();if(!o)throw new Error("No first to pop!");var i=[o],a=function(t){var n=t.location;return(new l.Vector3).subVectors(n,e.location).normalize()},c=function(){var o=i[i.length-1],c=e.adjacent.find((function(e){var i=a(e),c=a(o);if(i.dot(c)<.25)return!1;var s=(new l.Vector3).crossVectors(c,i).dot(n);switch(t){case r.Left:return s>0;case r.Right:return s<0;default:throw new Error("Unknown chirality")}}));if(!c)throw new Error("No next found");i.push(c),e.adjacent=e.adjacent.filter((function(e){return e.index!==c.index}))};for(;e.adjacent.length>0;)c();e.adjacent=i}(e,o)}))}return Object(h.a)(e,[{key:"buildEdgeVertices",value:function(){var e=this,t=[];return w.forEach((function(n){var r,o,i=[];t.push(i);for(var a=0;a<e.frequency-1;a++){o=r;var c=e.vertices[n[0]],s=e.vertices[n[1]],d=c.location,u=s.location,f=(new l.Vector3).lerpVectors(d,u,(a+1)/e.frequency);r=e.vertexAt(f),i.push(r),o?(g(r,o),a===e.frequency-2&&g(r,s)):g(r,c)}})),t}},{key:"buildFaces",value:function(e){var t=this,n=[];O.forEach((function(r,o){for(var i=function(e){return t.vertices[r[e]]},a=i(0).location,c=1;c<t.frequency-1;c++){var s=i(1),d=(new l.Vector3).lerpVectors(a,s.location,c/t.frequency);d.sub(a),n[c-1]=[];for(var u=1;u<t.frequency-c;u++){var f=i(2),j=(new l.Vector3).lerpVectors(a,f.location,u/t.frequency);j.sub(a);var h=(new l.Vector3).copy(a);h.add(d),h.add(j),n[c-1].push(t.vertexAt(h))}}for(var v=0;v<n.length;v++)for(var p=0;p<n[v].length;p++)if(p<n[v].length-1&&g(n[v][p],n[v][p+1]),v>0){var b=n[v][p];g(b,n[v-1][p]),g(b,n[v-1][p+1])}for(var x=[[],[],[]],w=0;w<t.frequency-2;w++){var O=n.length-w-1;x[0].push(n[w][0]),x[1].push(n[O][n[O].length-1]),x[2].push(n[0][w])}for(var y=0;y<x.length;y++)for(var V=m[o],N=e[V[y]],E=0;E<n.length;E++){var S=x[y][E];g(S,N[E]),g(S,N[E+1])}})),y.forEach((function(n){for(var r=0;r<n.length;r++){var o=(r+1)%n.length,i=n[r].front?0:t.frequency-2,a=n[o].front?0:t.frequency-2;g(e[n[r].edge][i],e[n[o].edge][a])}}))}},{key:"vertexBetween",value:function(e,t){var n=(new l.Vector3).copy(e.location).lerp(t.location,.5);return this.vertexAt(n)}},{key:"vertexAt",value:function(e){var t=e.length();e.multiplyScalar(this.radius/t);var n={index:this.vertices.length,location:e,adjacent:[]};return this.vertices.push(n),n}}]),e}(),p=.5257311121191336,b=.85065080835204,x=[new l.Vector3(+p,0,+b),new l.Vector3(+p,0,-b),new l.Vector3(+b,+p,0),new l.Vector3(-b,+p,0),new l.Vector3(0,+b,+p),new l.Vector3(0,-b,+p),new l.Vector3(-p,0,-b),new l.Vector3(-p,0,+b),new l.Vector3(-b,-p,0),new l.Vector3(+b,-p,0),new l.Vector3(0,-b,-p),new l.Vector3(0,+b,-p)],w=[[0,2],[0,4],[0,5],[0,7],[0,9],[1,10],[1,11],[1,2],[1,6],[1,9],[2,11],[2,4],[2,9],[3,11],[3,4],[3,6],[3,7],[3,8],[4,11],[4,7],[5,10],[5,7],[5,8],[5,9],[6,10],[6,11],[6,8],[7,8],[8,10],[9,10]],O=[[0,2,4],[0,2,9],[0,4,7],[0,5,7],[0,5,9],[1,2,11],[1,2,9],[1,6,10],[1,6,11],[1,9,10],[2,4,11],[3,4,11],[3,4,7],[3,6,11],[3,6,8],[3,7,8],[5,7,8],[5,8,10],[5,9,10],[6,8,10]],m=[[0,11,1],[0,12,4],[1,19,3],[2,21,3],[2,23,4],[7,10,6],[7,12,9],[8,24,5],[8,25,6],[9,29,5],[11,18,10],[14,18,13],[14,19,16],[15,25,13],[15,26,17],[16,27,17],[21,27,22],[22,28,20],[23,29,20],[26,28,24]],y=[[{edge:0,front:!0},{edge:1,front:!0},{edge:3,front:!0},{edge:2,front:!0},{edge:4,front:!0}],[{edge:7,front:!0},{edge:6,front:!0},{edge:8,front:!0},{edge:5,front:!0},{edge:9,front:!0}],[{edge:10,front:!0},{edge:11,front:!0},{edge:0,front:!1},{edge:12,front:!0},{edge:7,front:!1}],[{edge:14,front:!0},{edge:13,front:!0},{edge:15,front:!0},{edge:17,front:!0},{edge:16,front:!0}],[{edge:18,front:!0},{edge:11,front:!1},{edge:1,front:!1},{edge:19,front:!0},{edge:14,front:!1}],[{edge:21,front:!0},{edge:22,front:!0},{edge:20,front:!0},{edge:23,front:!0},{edge:2,front:!1}],[{edge:26,front:!0},{edge:24,front:!0},{edge:8,front:!1},{edge:25,front:!0},{edge:15,front:!1}],[{edge:27,front:!0},{edge:16,front:!1},{edge:19,front:!1},{edge:3,front:!1},{edge:21,front:!1}],[{edge:28,front:!0},{edge:22,front:!1},{edge:27,front:!1},{edge:17,front:!1},{edge:26,front:!1}],[{edge:4,front:!1},{edge:23,front:!1},{edge:29,front:!0},{edge:9,front:!1},{edge:12,front:!1}],[{edge:28,front:!1},{edge:20,front:!1},{edge:29,front:!1},{edge:5,front:!1},{edge:24,front:!1}],[{edge:6,front:!1},{edge:10,front:!1},{edge:18,front:!1},{edge:13,front:!1},{edge:25,front:!1}]];function V(e,t){var n=Math.min(e.index,t.index),r=Math.max(e.index,t.index);return"".concat(n,",").concat(r)}function N(e,t){var n=t*(e.chirality===r.Left?1:-1),o=[];function i(e){var t={index:o.length,point:e};return o.push(t),t}var a=[],c={};e.vertices.forEach((function(e){e.adjacent.forEach((function(t){if(!(t.index>e.index)){var n=a.length,r=i((new l.Vector3).copy(e.location)),o=i(new l.Vector3),s=i(new l.Vector3),d={index:n,jointA:r,jointD:i((new l.Vector3).copy(t.location)),jointB:o,jointC:s,vertexA:e,vertexB:t};a.push(d),c[V(d.vertexA,d.vertexB)]=d}}))}));var s=e.vertices.map((function(e){return{adjacentBars:e.adjacent.map((function(t){return c[V(e,t)]}))}}));function d(e,t,n){var r=(new l.Vector3).crossVectors(e.jointA.point,e.jointD.point).normalize(),o=new l.Plane(r);if(s[e.vertexA.index].adjacentBars.findIndex((function(t){return t.index===e.index}))<0)throw new Error("adjacent not found");var i=function(e,t){return(new l.Vector3).copy(t).add((new l.Vector3).subVectors(t,e))},a=new l.Line3(i(t.jointA.point,t.jointD.point),i(t.jointD.point,t.jointA.point)),c=new l.Vector3;return o.intersectLine(a,c),c.distanceTo(t.jointA.point)<c.distanceTo(t.jointD.point)?n?(t.jointA.point.copy(c),t.jointA):(t.jointB.point.copy(c),t.jointB):n?(t.jointD.point.copy(c),t.jointD):(t.jointC.point.copy(c),t.jointC)}a.forEach((function(e){var t=e.jointA,r=e.jointD,o=(new l.Vector3).lerpVectors(t.point,r.point,.5).normalize();t.point.applyAxisAngle(o,n),r.point.applyAxisAngle(o,n)}));var u=[];return s.forEach((function(e){e.adjacentBars.forEach((function(t,n){var r=(n+1)%e.adjacentBars.length,o=e.adjacentBars[r],i={jointA:d(t,o,!0),jointB:d(o,t,!1),index:a.length+u.length};u.push(i)}))})),{bars:a,bolts:u,joints:o}}function E(e){return Math.PI*e/180}var S=n(14),A=n(9),F=1e3;function B(e){var t=e.spec,n=e.setSpec,r=e.saveCSV,i=Object(o.useState)(t.frequency.toString()),a=Object(s.a)(i,2),c=a[0],d=a[1],u=Object(o.useState)(t.degrees.toString()),f=Object(s.a)(u,2),l=f[0],j=f[1],h=Object(o.useState)(t.radius.toString()),g=Object(s.a)(h,2),v=g[0],p=g[1],b=Object(o.useState)((t.boltWidth*F).toString()),x=Object(s.a)(b,2),w=x[0],O=x[1],m=Object(o.useState)((t.barWidth*F).toString()),y=Object(s.a)(m,2),V=y[0],N=y[1],E=Object(o.useState)((t.barHeight*F).toString()),B=Object(s.a)(E,2),D=B[0],C=B[1],q=Object(o.useState)((t.barExtension*F).toString()),W=Object(s.a)(q,2),L=W[0],z=W[1],I=Object(o.useState)((t.boltExtension*F).toString()),k=Object(s.a)(I,2),H=k[0],M=k[1];function R(e){var t=parseInt(e,10);return!isNaN(t)&&(t<=10&&t>0)}return Object(A.jsxs)(S.b,{onSubmit:function(e){e.preventDefault(),function(){var e={frequency:parseInt(c,10),degrees:parseFloat(l),radius:parseFloat(v),boltWidth:parseFloat(w)/F,barWidth:parseFloat(V)/F,barHeight:parseFloat(D)/F,barExtension:parseFloat(L)/F,boltExtension:parseFloat(H)/F};!R(c)||isNaN(e.degrees)||isNaN(e.radius)||isNaN(e.boltWidth)||isNaN(e.barWidth)||isNaN(e.barHeight)||isNaN(e.barExtension)||isNaN(e.boltExtension)||n(e)}()},className:"spec-editor",children:[Object(A.jsx)("h3",{className:"w-100 text-center",children:Object(A.jsx)("a",{target:"_BLANK",href:"https://github.com/CivilSource/DavinciDome",children:"Da Vinci Dome"})}),Object(A.jsx)("hr",{}),Object(A.jsxs)(S.c,{children:[Object(A.jsx)(S.e,{for:"frequency",children:"Frequency [1..10]"}),Object(A.jsx)(S.d,{id:"frequency",value:c,valid:R(c),invalid:!R(c),onChange:function(e){var t=e.target;return d(t.value)}})]}),Object(A.jsxs)(S.c,{children:[Object(A.jsx)(S.e,{for:"degrees",children:"Rotation [deg]"}),Object(A.jsx)(S.d,{id:"degrees",value:l,valid:!isNaN(parseFloat(l)),invalid:isNaN(parseFloat(l)),onChange:function(e){var t=e.target;return j(t.value)}})]}),Object(A.jsxs)(S.c,{children:[Object(A.jsx)(S.e,{for:"radius",children:"Radius [m]"}),Object(A.jsx)(S.d,{id:"radius",value:v,valid:!isNaN(parseFloat(v)),invalid:isNaN(parseFloat(v)),onChange:function(e){var t=e.target;return p(t.value)}})]}),Object(A.jsxs)(S.c,{children:[Object(A.jsx)(S.e,{for:"boltWidth",children:"Bolt Diam [mm]"}),Object(A.jsx)(S.d,{id:"boltWidth",value:w,valid:!isNaN(parseFloat(w)),invalid:isNaN(parseFloat(w)),onChange:function(e){var t=e.target;return O(t.value)}})]}),Object(A.jsxs)(S.c,{children:[Object(A.jsx)(S.e,{for:"barWidth",children:"Bar Width [mm]"}),Object(A.jsx)(S.d,{id:"barWidth",value:V,valid:!isNaN(parseFloat(V)),invalid:isNaN(parseFloat(V)),onChange:function(e){var t=e.target;return N(t.value)}})]}),Object(A.jsxs)(S.c,{children:[Object(A.jsx)(S.e,{for:"barHeight",children:"Bar Height [mm]"}),Object(A.jsx)(S.d,{id:"barHeight",value:D,valid:!isNaN(parseFloat(D)),invalid:isNaN(parseFloat(D)),onChange:function(e){var t=e.target;return C(t.value)}})]}),Object(A.jsxs)(S.c,{children:[Object(A.jsx)(S.e,{for:"boltExtension",children:"Bolt Extra [mm]"}),Object(A.jsx)(S.d,{id:"boltExtension",value:H,valid:!isNaN(parseFloat(H)),invalid:isNaN(parseFloat(H)),onChange:function(e){var t=e.target;return M(t.value)}})]}),Object(A.jsxs)(S.c,{children:[Object(A.jsx)(S.e,{for:"barExtension",children:"Bar Extra [mm]"}),Object(A.jsx)(S.d,{id:"barExtension",value:L,valid:!isNaN(parseFloat(L)),invalid:isNaN(parseFloat(L)),onChange:function(e){var t=e.target;return z(t.value)}})]}),Object(A.jsx)("hr",{}),Object(A.jsx)(S.a,{color:"success",className:"w-100 my-1",type:"submit",children:"Regenerate"}),Object(A.jsx)(S.a,{color:"info",className:"w-100",onClick:r,children:"Download"})]})}var D=n(36),C=n.n(D),q=n(37),W=n.n(q);function L(e){return e.toFixed(5).replace(/[.]/,",")}function z(e){var t=new W.a;t.file("joints.csv",function(e){var t=[];return t.push(["index","x","y","z"]),e.joints.forEach((function(e,n){return t.push([(n+1).toFixed(0),L(e.point.x),L(e.point.y),L(e.point.z)])})),t.map((function(e){return e.join(";")})).join("\n")}(e)),t.file("intervals.csv",function(e){var t=[];return t.push(["joints","type"]),e.daVinciIntervals.forEach((function(e,n){var r=e.nodeIndexes.map((function(e){return e+1})).join(",");t.push(['"=""'.concat(r,'"""'),e.type])})),t.map((function(e){return e.join(";")})).join("\n")}(e)),t.generateAsync({type:"blob",mimeType:"application/zip"}).then((function(e){C.a.saveAs(e,"davinci-".concat((new Date).toISOString().replace(/[.].*/,"").replace(/[:T_]/g,"-"),".zip"))}))}var I=new l.Vector3(0,1,0),k=new l.Vector3(0,-1,0);function H(e){var t=e.bar,n=e.renderSpec,r=t.jointA.point.distanceTo(t.jointD.point),o=(new l.Vector3).subVectors(t.jointD.point,t.jointA.point).normalize(),i=(new l.Vector3).lerpVectors(t.jointA.point,t.jointD.point,.5),a=(new l.Vector3).crossVectors(i,o).normalize(),c=(new l.Matrix4).makeBasis((new l.Vector3).copy(i).normalize(),o,a).setPosition(i).scale(new l.Vector3(n.barHeight,r+n.barExtension,n.barWidth));return Object(A.jsxs)("mesh",{matrix:c,matrixAutoUpdate:!1,children:[Object(A.jsx)("boxBufferGeometry",{attach:"geometry"}),Object(A.jsx)("meshLambertMaterial",{attach:"material",color:"white"})]})}function M(e){var t=e.bolt,n=e.renderSpec,r=t.jointA.point.distanceTo(t.jointB.point),o=(new l.Vector3).subVectors(t.jointB.point,t.jointA.point).normalize(),i=(new l.Vector3).lerpVectors(t.jointA.point,t.jointB.point,.5),a=new l.Vector3(n.boltWidth,r+n.boltExtension,n.boltWidth),c=I.dot(o),s=(new l.Euler).setFromQuaternion((new l.Quaternion).setFromUnitVectors(c>0?I:k,o));return Object(A.jsxs)("mesh",{scale:a,rotation:s,position:i,children:[Object(A.jsx)("cylinderBufferGeometry",{attach:"geometry",args:[1,1,1]}),Object(A.jsx)("meshLambertMaterial",{attach:"material",color:"orange"})]})}var R={frequency:2,degrees:30,radius:7,boltWidth:.05,barWidth:.3,barHeight:.02,barExtension:.3,boltExtension:.2},T=function(e){return e.degrees>0?r.Right:r.Left};var P=function(){var e=Object(o.useState)([window.innerWidth,window.innerHeight]),t=Object(s.a)(e,2),n=t[0],r=t[1],i=Object(o.useState)(R),a=Object(s.a)(i,2),c=a[0],l=a[1],j=Object(o.useState)(N(new v(c.frequency,c.radius,T(c)),E(c.degrees))),h=Object(s.a)(j,2),g=h[0],p=h[1],b=Object(o.useState)(0),x=Object(s.a)(b,2),w=x[0],O=x[1];return Object(o.useEffect)((function(){var e=function(){return r([window.innerWidth,window.innerHeight])};return window.addEventListener("resize",e),function(){return window.removeEventListener("resize",e)}}),[]),Object(o.useEffect)((function(){var e=c.frequency,t=c.radius,n=c.degrees,r=Math.abs(E(n));p(N(new v(e,t,T(c)),r)),console.log("RENDER_SPEC",c.radius),O((function(e){return e+1}))}),[c]),Object(A.jsxs)("div",{className:"App",style:{width:n[0],height:n[1]},children:[Object(A.jsx)(B,{spec:c,setSpec:function(e){return l(e)},saveCSV:function(){return z(function(e){var t=e.bars,n=e.bolts,r=e.joints,o=[];return t.forEach((function(e){o.push({nodeIndexes:[e.jointA.index,e.jointB.index,e.jointC.index,e.jointD.index],type:"type 1"})})),n.forEach((function(e){o.push({nodeIndexes:[e.jointA.index,e.jointB.index],type:"type 2"})})),{joints:r,daVinciIntervals:o}}(g))}}),Object(A.jsxs)(f.a,{className:"canvas",children:[Object(A.jsx)("ambientLight",{intensity:.05}),Object(A.jsxs)("mesh",{onDoubleClick:function(e){var t=e.face;if(t){var n=t.normal.multiplyScalar(e.camera.position.length());e.camera.position.copy(n)}},children:[Object(A.jsx)("boxGeometry",{args:[1,1,1]}),Object(A.jsx)("meshStandardMaterial",{transparent:!0,opacity:.8,color:"orange"})]}),g.bars.map((function(e,t){return Object(A.jsx)(H,{bar:e,renderSpec:c},"bar-".concat(w,"-#").concat(t))})),g.bolts.map((function(e,t){return Object(A.jsx)(M,{bolt:e,renderSpec:c},"bolt-".concat(w,"-#").concat(t))})),Object(A.jsx)(d.a,{makeDefault:!0,position:[3*c.radius,0,0],children:Object(A.jsx)("pointLight",{position:[0,10*c.radius,0],color:"white"})}),Object(A.jsx)(u.a,{})]})]})},G=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,72)).then((function(t){var n=t.getCLS,r=t.getFID,o=t.getFCP,i=t.getLCP,a=t.getTTFB;n(e),r(e),o(e),i(e),a(e)}))};c.a.render(Object(A.jsx)(i.a.StrictMode,{children:Object(A.jsx)(P,{})}),document.getElementById("root")),G()}},[[61,1,2]]]);
//# sourceMappingURL=main.6a9dc22a.chunk.js.map